############################
# CORE
############################
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -g mouse on
set -g history-limit 100000
set -g escape-time 0

############################
# PREFIX
############################
unbind C-b
set -g prefix C-s
bind C-s send-prefix

############################
# RELOAD
# Changed to 'R' to avoid conflict with Resize Mode
############################
bind R source-file ~/.tmux.conf \; display "Tmux reloaded!"

############################
# INDEX
############################
set -g base-index 1
setw -g pane-base-index 1

############################
# SPLITS
############################
unbind '"'
unbind %
bind | split-window -h
bind - split-window -v

############################
# MONOKAI PRO COLORS
############################
set -g @bg "#2D2A2E"
set -g @fg "#FCFCFA"
set -g @yellow "#FFD866"
set -g @orange "#FC9867"
set -g @red "#FF6188"
set -g @purple "#AB9DF2"
set -g @blue "#78DCE8"
set -g @green "#A9DC76"
set -g @gray "#727072"

############################
# STATUS BAR (TOP)
############################
set -g status on
set -g status-position top
set -g status-interval 3

set -g status-style "bg=#2D2A2E fg=#FCFCFA"

set -g status-left-length 40
set -g status-right-length 100

set -g status-left "#[fg=#A9DC76]   #S "
set -g status-right "#[fg=#FFD866]  %I:%M %p #[fg=#78DCE8]  %d-%m-%Y #[fg=#AB9DF2]  #(whoami) "

############################
# WINDOWS
############################
set -g window-status-style "fg=#727072 bg=#2D2A2E"
set -g window-status-current-style "fg=#2D2A2E bg=#A9DC76 bold"

set -g window-status-format " #[fg=#727072]#I:#W "
set -g window-status-current-format " #[fg=#2D2A2E]#I:#W "

############################
# PANE BORDERS
############################
set -g pane-border-style "fg=#727072"
set -g pane-active-border-style "fg=#78DCE8"

############################
# MESSAGES
############################
set -g message-style "bg=#2D2A2E fg=#FFD866"
set -g message-command-style "bg=#2D2A2E fg=#AB9DF2"

############################
# COPY MODE
############################
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
setw -g mode-style "bg=#78DCE8 fg=#2D2A2E"

############################
# EXTRA POLISH
############################
set -g renumber-windows on
set -g status-justify centre
set -g display-panes-active-colour "#A9DC76"
set -g display-panes-colour "#FF6188"

################################################################
# ZELLIJ-LIKE MODES
################################################################

##### PANE MODE (Ctrl+s p) #####
# Not sticky: actions are usually one-off
bind p switch-client -T pane-mode

bind -T pane-mode h select-pane -L
bind -T pane-mode j select-pane -D
bind -T pane-mode k select-pane -U
bind -T pane-mode l select-pane -R

bind -T pane-mode c command-prompt -p "Rename pane:" "select-pane -T '%%'"
bind -T pane-mode d split-window -v
bind -T pane-mode r split-window -h
bind -T pane-mode n split-window
bind -T pane-mode x kill-pane
bind -T pane-mode f resize-pane -Z
bind -T pane-mode z display-panes
bind -T pane-mode w break-pane
bind -T pane-mode Tab select-pane -t :.+
bind -T pane-mode Escape switch-client -T root

##### TAB MODE (Ctrl+s t) #####
# Sticky for navigation (h/l), one-off for creation/destruction
bind t switch-client -T tab-mode

bind -T tab-mode h previous-window \; switch-client -T tab-mode
bind -T tab-mode l next-window \; switch-client -T tab-mode
bind -T tab-mode j next-window \; switch-client -T tab-mode
bind -T tab-mode k previous-window \; switch-client -T tab-mode

bind -T tab-mode n new-window
bind -T tab-mode x kill-window
bind -T tab-mode r command-prompt -p "Rename tab:" "rename-window '%%'"
bind -T tab-mode b break-pane
bind -T tab-mode s setw synchronize-panes
bind -T tab-mode Tab last-window
bind -T tab-mode Escape switch-client -T root
bind -T tab-mode Enter switch-client -T root

##### RESIZE MODE (Ctrl+s r) #####
# Fully Sticky
bind r switch-client -T resize-mode

bind -T resize-mode h resize-pane -L 5 \; switch-client -T resize-mode
bind -T resize-mode j resize-pane -D 5 \; switch-client -T resize-mode
bind -T resize-mode k resize-pane -U 5 \; switch-client -T resize-mode
bind -T resize-mode l resize-pane -R 5 \; switch-client -T resize-mode

bind -T resize-mode H resize-pane -L 10 \; switch-client -T resize-mode
bind -T resize-mode J resize-pane -D 10 \; switch-client -T resize-mode
bind -T resize-mode K resize-pane -U 10 \; switch-client -T resize-mode
bind -T resize-mode L resize-pane -R 10 \; switch-client -T resize-mode

bind -T resize-mode + resize-pane -U 5 \; switch-client -T resize-mode
bind -T resize-mode - resize-pane -D 5 \; switch-client -T resize-mode
bind -T resize-mode = resize-pane -U 5 \; switch-client -T resize-mode
bind -T resize-mode Escape switch-client -T root
bind -T resize-mode Enter switch-client -T root

##### MOVE MODE (Ctrl+s m) #####
# Fully Sticky
bind m switch-client -T move-mode

bind -T move-mode h swap-pane -U \; switch-client -T move-mode
bind -T move-mode j swap-pane -D \; switch-client -T move-mode
bind -T move-mode k swap-pane -U \; switch-client -T move-mode
bind -T move-mode l swap-pane -D \; switch-client -T move-mode

bind -T move-mode n swap-pane -t :.+ \; switch-client -T move-mode
bind -T move-mode p swap-pane -t :.- \; switch-client -T move-mode
bind -T move-mode Tab swap-pane -t :.+ \; switch-client -T move-mode
bind -T move-mode Escape switch-client -T root
bind -T move-mode Enter switch-client -T root

##### SCROLL MODE (Ctrl+s s) #####
bind s copy-mode

##### SESSION MODE (Ctrl+s o) #####
bind o choose-tree

################################################################
# GLOBAL ALT BINDINGS (Optional / Fast)
################################################################
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

bind -n M-+ resize-pane -U 5
bind -n M-- resize-pane -D 5
bind -n M-= resize-pane -U 5

bind -n M-[ previous-layout
bind -n M-] next-layout

################################################################
# QUICK TAB NUMBERS
################################################################
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9

################################################################
# SCRATCHPAD (FLOATING WINDOW)
################################################################
# 1. If currently in 'scratch' session: Detach (closes popup)
# 2. If not: Open popup.
#    Inside popup: 
#    - Try creating 'scratch' session (silently fails if exists)
#    - Force status bar OFF for 'scratch' session
#    - Attach to 'scratch' session
bind -n M-f if-shell -F '#{==:#{session_name},scratch}' \
    "detach-client" \
    "display-popup -E -w 50% -h 50% 'tmux new-session -d -s scratch 2>/dev/null; tmux set -t scratch status off; tmux attach -t scratch'"

# Popup styling
set -g popup-border-style "fg=#727072"
set -g popup-border-lines rounded

############################
# PLUGINS
############################
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-restore 'of'
set -g @continuum-save-interval '15'

############################
# TPM
############################
run '~/.tmux/plugins/tpm/tpm'
